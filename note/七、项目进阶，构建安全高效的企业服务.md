## 项目进阶、构建安全高效的企业服务

#### 一：Spring Security

- 简介
  - Spring Security 是一个专注为 Java 应用程序提供身份认证和授权的框架，它的强大之处在于它可以轻松扩展以满足自定义的需求。
- 特征
  - 对身份的<strong style="color: red">认证</strong>和<strong style="color: red">授权</strong>提供全面的，可扩展的支持
  - 防止各种攻击，如会话固定攻击，点击劫持，csrf攻击等
  - 支持与 Servlet API，Spring MVC 等 Web 技术集成
- 官网地址
  - http://spring.io/projects/spring-security

- Spring Security 原理示意图

<img src="https://tva1.sinaimg.cn/large/008i3skNgy1gruvs7gw6ij31ql0u0do2.jpg" alt="image-20210625222746721" style="zoom:50%;" align="left"/>



#### 二：权限控制

- 登陆检查

  - 之前采用拦截器登陆实现了登陆检查，这是简单的权限管理方案，现在将其废弃

- 授权配置

  - 对当前系统内包含的所有的请求，分配访问权限（普通用户，版主，管理员）

- 认证方案

  - 绕过 Security 认证流程，采用系统原来的认证方案

- CSRF 配置

  - CSRF  是什么？

    CSRF 即：cross-site-request-forgery（ 跨站请求伪造）

    - 浏览并登陆信任网站 A
    - 验证通过，在 Client 处产生 A 的 Cookie
    - 用户在没有登出 A 网站的情况下，访问危险⚠️网站 B
    - B 盗取 A 的 Cookie 信息
    - B 带着盗取的 Cookie 伪造用户身份向 A 网站发出请求，伪造身份登陆

    <img src="https://tva1.sinaimg.cn/large/008i3skNgy1grw25imb4kj30xk0u00wx.jpg" alt="image-20210626225342665" style="zoom:50%;" align="left"/>

  - Security 防止 CSRF 攻击的基本原理，以及表单，AJAX 相关的配置

    - Spring Security 防止 CSRF 攻击的原理就是会根据，访问的 request 是否携带 token

    <img src="https://tva1.sinaimg.cn/large/008i3skNgy1grw2iaggp2j30w20u0gre.jpg" alt="image-20210626230610378" style="zoom:50%;" align="left"/>


#### 三：置顶，加精，删除

- 功能实现
  - 点击 “置顶”，修改帖子的类型
  - 点击 “加精”，“删除” 修改帖子的状态
- 权限管理
  - 版主可以执行 “置顶”，“加精” 操作
  - 管理员可以执行 “删除”。操作。
- 按钮显示
  - 版主可以看到 “置顶”，“加精” 按钮
  - 管理员可以看到 “删除” 按钮

需要用到的包

```xml
<dependency>
    <groupId>org.thymeleaf.extras</groupId>
    <artifactId>thymeleaf-extras-springsecurity5</artifactId>
</dependency>
```



#### 四：